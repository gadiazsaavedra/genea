"use strict";(self.webpackChunkgenea_client=self.webpackChunkgenea_client||[]).push([[975],{2975:(e,a,t)=>{t.r(a),t.d(a,{default:()=>p});var s=t(5043),o=t(3216),r=t(4505),n=t(2014);const l={uploadProfilePhoto:async(e,a)=>{try{const t=new FormData;t.append("profilePhoto",a);return(await r.A.post(`/media/profilePhoto/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){throw t}},uploadMedia:async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];try{const o=new FormData;a.forEach(e=>{o.append("files",e)}),t.length>0&&t.forEach((e,a)=>{o.append("descriptions",e)}),s.length>0&&s.forEach((e,a)=>{o.append("fileTypes",e)});return(await r.A.post(`/media/${e}`,o,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw o}},getPersonMedia:async e=>{try{return(await r.A.get(`/media/${e}`)).data}catch(a){throw a}},deleteMedia:async e=>{try{return(await r.A.delete(`/media/${e}`)).data}catch(a){throw a}},uploadToStorage:async(e,a,t)=>{try{const s=e.name.split(".").pop(),o=`${a}/${t||Math.random().toString(36).substring(2)}.${s}`,{data:r,error:l}=await n.N.storage.from("genea-media").upload(o,e,{cacheControl:"3600",upsert:!1});if(l)throw l;const{data:i}=n.N.storage.from("genea-media").getPublicUrl(o);return{path:o,url:i.publicUrl}}catch(s){throw s}},deleteFromStorage:async e=>{try{const{error:a}=await n.N.storage.from("genea-media").remove([e]);if(a)throw a;return!0}catch(a){throw a}}};var i=t(579);const c=e=>{let{personId:a,type:t="photos",onUploadComplete:o}=e;const[r,n]=(0,s.useState)([]),[c,d]=(0,s.useState)([]),[h,p]=(0,s.useState)([]),[m,u]=(0,s.useState)([]),[x,f]=(0,s.useState)(!1),[g,v]=(0,s.useState)(0),[j,N]=(0,s.useState)(null),[y,w]=(0,s.useState)([]),b=["Certificado de nacimiento","Certificado de matrimonio","Certificado de defunci\xf3n","Documento de identidad","Fotograf\xeda hist\xf3rica","Carta","Testamento","Otro"];return(0,i.jsxs)("div",{className:"media-upload",children:[(0,i.jsx)("div",{className:"upload-header",children:(0,i.jsxs)("h3",{children:["profilePhoto"===t&&"Subir foto de perfil","photos"===t&&"Subir fotos","documents"===t&&"Subir documentos"]})}),(0,i.jsxs)("div",{className:"upload-content",children:[(0,i.jsxs)("div",{className:"file-input-container",children:[(0,i.jsx)("input",{type:"file",id:"file-input",onChange:e=>{const a=Array.from(e.target.files);n(a);const s=a.map(e=>({file:e,url:URL.createObjectURL(e)}));w(s),"photos"===t?d(new Array(a.length).fill("")):"documents"===t&&(p(new Array(a.length).fill("")),u(new Array(a.length).fill("Otro")))},multiple:"profilePhoto"!==t,accept:"documents"===t?".pdf,.doc,.docx,.txt":"image/*",disabled:x}),(0,i.jsx)("label",{htmlFor:"file-input",className:"file-input-label",children:r.length>0?`${r.length} archivo(s) seleccionado(s)`:"Seleccionar archivos"})]}),y.length>0&&(0,i.jsx)("div",{className:"preview-container",children:y.map((e,a)=>(0,i.jsxs)("div",{className:"preview-item",children:[e.file.type.startsWith("image/")?(0,i.jsx)("img",{src:e.url,alt:`Preview ${a}`,className:"preview-image"}):(0,i.jsxs)("div",{className:"document-preview",children:[(0,i.jsx)("span",{className:"document-icon",children:"\ud83d\udcc4"}),(0,i.jsx)("span",{className:"document-name",children:e.file.name})]}),"photos"===t&&(0,i.jsx)("input",{type:"text",placeholder:"Descripci\xf3n (opcional)",value:c[a]||"",onChange:e=>((e,a)=>{const t=[...c];t[e]=a,d(t)})(a,e.target.value),disabled:x,className:"caption-input"}),"documents"===t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"text",placeholder:"T\xedtulo del documento",value:h[a]||"",onChange:e=>((e,a)=>{const t=[...h];t[e]=a,p(t)})(a,e.target.value),disabled:x,className:"title-input"}),(0,i.jsx)("select",{value:m[a]||"Otro",onChange:e=>((e,a)=>{const t=[...m];t[e]=a,u(t)})(a,e.target.value),disabled:x,className:"type-select",children:b.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]})]},a))}),j&&(0,i.jsx)("div",{className:"upload-error",children:j}),x&&(0,i.jsxs)("div",{className:"progress-container",children:[(0,i.jsx)("div",{className:"progress-bar",children:(0,i.jsx)("div",{className:"progress-fill",style:{width:`${g}%`}})}),(0,i.jsxs)("div",{className:"progress-text",children:[g,"%"]})]}),(0,i.jsx)("div",{className:"upload-actions",children:(0,i.jsx)("button",{className:"upload-button",onClick:async()=>{if(0!==r.length){f(!0),v(0),N(null);try{let e;const s=setInterval(()=>{v(e=>e>=90?(clearInterval(s),90):e+10)},300);"profilePhoto"===t?e=await l.uploadProfilePhoto(a,r[0]):"photos"===t?e=await l.uploadPhotos(a,r,c):"documents"===t&&(e=await l.uploadDocuments(a,r,h,m)),clearInterval(s),v(100),y.forEach(e=>URL.revokeObjectURL(e.url)),setTimeout(()=>{n([]),d([]),p([]),u([]),w([]),f(!1),v(0),o&&o(e)},1e3)}catch(e){console.error("Error uploading files:",e),N("Error al subir los archivos. Por favor, int\xe9ntalo de nuevo."),f(!1)}}},disabled:0===r.length||x,children:x?"Subiendo...":"Subir"})})]})]})},d=e=>{let{person:a,mediaType:t="photos",onMediaDelete:o}=e;const[r,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),m="photos"===t?a.photos||[]:a.documents||[],u=()=>{n(null)},x=e=>e?new Date(e).toLocaleDateString():"",f=e=>{const a=e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp"].includes(a)},g=e=>{switch(e.split(".").pop().toLowerCase()){case"pdf":return"\ud83d\udcc4";case"doc":case"docx":return"\ud83d\udcdd";case"xls":case"xlsx":return"\ud83d\udcca";case"ppt":case"pptx":return"\ud83d\udcd1";default:return"\ud83d\udcc1"}};return(0,i.jsxs)("div",{className:"media-gallery",children:[h&&(0,i.jsx)("div",{className:"gallery-error",children:h}),0===m.length?(0,i.jsx)("div",{className:"no-media",children:"photos"===t?"No hay fotos disponibles":"No hay documentos disponibles"}):(0,i.jsx)("div",{className:"gallery-grid",children:m.map(e=>(0,i.jsxs)("div",{className:"gallery-item",onClick:()=>(e=>{n(e)})(e),children:["photos"===t||f(e.url)?(0,i.jsx)("div",{className:"gallery-image-container",children:(0,i.jsx)("img",{src:e.url,alt:e.caption||"Imagen",className:"gallery-image"})}):(0,i.jsxs)("div",{className:"gallery-document",children:[(0,i.jsx)("span",{className:"document-icon",children:g(e.url)}),(0,i.jsx)("span",{className:"document-title",children:e.title||"Documento"})]}),(0,i.jsxs)("div",{className:"gallery-item-info",children:["photos"===t?(0,i.jsx)("span",{className:"gallery-caption",children:e.caption||"Sin descripci\xf3n"}):(0,i.jsx)("span",{className:"gallery-title",children:e.title||"Sin t\xedtulo"}),(0,i.jsx)("span",{className:"gallery-date",children:x(e.date)})]})]},e._id))}),r&&(0,i.jsx)("div",{className:"media-detail-overlay",onClick:u,children:(0,i.jsxs)("div",{className:"media-detail-container",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"media-detail-header",children:[(0,i.jsx)("h3",{children:"photos"===t?"Foto":"Documento"}),(0,i.jsx)("button",{className:"close-button",onClick:u,children:"\xd7"})]}),(0,i.jsxs)("div",{className:"media-detail-content",children:["photos"===t||f(r.url)?(0,i.jsx)("img",{src:r.url,alt:r.caption||"Imagen",className:"detail-image"}):(0,i.jsxs)("div",{className:"detail-document",children:[(0,i.jsx)("span",{className:"document-icon large",children:g(r.url)}),(0,i.jsx)("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"document-link",children:"Ver documento"})]}),(0,i.jsxs)("div",{className:"media-info",children:["photos"===t&&r.caption&&(0,i.jsxs)("div",{className:"info-row",children:[(0,i.jsx)("span",{className:"info-label",children:"Descripci\xf3n:"}),(0,i.jsx)("span",{className:"info-value",children:r.caption})]}),"documents"===t&&(0,i.jsxs)(i.Fragment,{children:[r.title&&(0,i.jsxs)("div",{className:"info-row",children:[(0,i.jsx)("span",{className:"info-label",children:"T\xedtulo:"}),(0,i.jsx)("span",{className:"info-value",children:r.title})]}),r.type&&(0,i.jsxs)("div",{className:"info-row",children:[(0,i.jsx)("span",{className:"info-label",children:"Tipo:"}),(0,i.jsx)("span",{className:"info-value",children:r.type})]})]}),r.date&&(0,i.jsxs)("div",{className:"info-row",children:[(0,i.jsx)("span",{className:"info-label",children:"Fecha:"}),(0,i.jsx)("span",{className:"info-value",children:x(r.date)})]})]})]}),(0,i.jsx)("div",{className:"media-detail-actions",children:(0,i.jsx)("button",{className:"delete-button",onClick:()=>(async e=>{if(window.confirm("\xbfEst\xe1s seguro de que deseas eliminar este archivo?")){d(!0),p(null);try{await l.deleteMedia(a._id,t,e),r&&r._id===e&&n(null),o&&o(e)}catch(s){console.error("Error deleting media:",s),p("Error al eliminar el archivo. Por favor, int\xe9ntalo de nuevo.")}finally{d(!1)}}})(r._id),disabled:c,children:c?"Eliminando...":"Eliminar"})})]})})]})};var h=t(6445);const p=()=>{const{personId:e}=(0,o.g)(),a=(0,o.Zp)(),[t,r]=(0,s.useState)(null),[n,l]=(0,s.useState)(!0),[p,m]=(0,s.useState)(null),[u,x]=(0,s.useState)("photos"),[f,g]=(0,s.useState)(!1),[v,j]=(0,s.useState)("photos");(0,s.useEffect)(()=>{(async()=>{try{l(!0);try{const a=await h.A.getPersonById(e);if(a.success&&a.data)return r(a.data),void l(!1)}catch(a){console.warn("Error al cargar datos de la API, usando datos de ejemplo:",a)}setTimeout(()=>{r({_id:e,fullName:"Juan P\xe9rez",birthDate:"1950-05-15",birthPlace:"Madrid, Espa\xf1a",isAlive:!0,profilePhoto:"https://via.placeholder.com/150",photos:[{_id:"photo1",url:"https://via.placeholder.com/500x300?text=Foto+1",caption:"Vacaciones en la playa",date:"2020-07-15"},{_id:"photo2",url:"https://via.placeholder.com/500x300?text=Foto+2",caption:"Reuni\xf3n familiar",date:"2019-12-25"},{_id:"photo3",url:"https://via.placeholder.com/500x300?text=Foto+3",caption:"Graduaci\xf3n",date:"2015-06-30"}],documents:[{_id:"doc1",url:"https://via.placeholder.com/100x100?text=PDF",title:"Certificado de nacimiento",type:"Certificado de nacimiento",date:"2010-01-10"},{_id:"doc2",url:"https://via.placeholder.com/100x100?text=DOC",title:"Carta familiar",type:"Carta",date:"1995-03-22"}]}),l(!1)},800)}catch(t){m("Error al cargar los datos de la persona"),l(!1),console.error("Error fetching person data:",t)}})()},[e]);const N=e=>{x(e)},y=e=>{j(e),g(!0)};return n?(0,i.jsx)("div",{className:"loading-container",children:"Cargando informaci\xf3n..."}):p?(0,i.jsx)("div",{className:"error-container",children:p}):(0,i.jsxs)("div",{className:"media-management-container",children:[(0,i.jsxs)("div",{className:"media-header",children:[(0,i.jsxs)("div",{className:"person-info",children:[(0,i.jsx)("div",{className:"person-photo",children:t.profilePhoto?(0,i.jsx)("img",{src:t.profilePhoto,alt:t.fullName}):(0,i.jsx)("div",{className:"no-photo",children:t.fullName.charAt(0)})}),(0,i.jsxs)("div",{className:"person-details",children:[(0,i.jsx)("h1",{children:t.fullName}),(0,i.jsxs)("p",{children:[t.birthDate?new Date(t.birthDate).getFullYear():""," - ",!t.isAlive&&t.deathDate?new Date(t.deathDate).getFullYear():""]})]})]}),(0,i.jsxs)("div",{className:"media-actions",children:[(0,i.jsx)("button",{className:"btn btn-outline",onClick:()=>y("profilePhoto"),children:"Cambiar foto de perfil"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>a(`/persons/${e}`),children:"Ver perfil completo"})]})]}),(0,i.jsxs)("div",{className:"media-tabs",children:[(0,i.jsxs)("button",{className:"tab-button "+("photos"===u?"active":""),onClick:()=>N("photos"),children:["Fotos (",t.photos?t.photos.length:0,")"]}),(0,i.jsxs)("button",{className:"tab-button "+("documents"===u?"active":""),onClick:()=>N("documents"),children:["Documentos (",t.documents?t.documents.length:0,")"]})]}),(0,i.jsxs)("div",{className:"media-content",children:[(0,i.jsx)("div",{className:"media-toolbar",children:(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>y(u),children:"photos"===u?"Subir fotos":"Subir documentos"})}),(0,i.jsx)("div",{className:"media-gallery-container",children:(0,i.jsx)(d,{person:t,mediaType:u,onMediaDelete:e=>{r(a=>"photos"===u?{...a,photos:a.photos.filter(a=>a._id!==e)}:"documents"===u?{...a,documents:a.documents.filter(a=>a._id!==e)}:a)}})})]}),f&&(0,i.jsx)("div",{className:"upload-modal-overlay",children:(0,i.jsxs)("div",{className:"upload-modal-content",children:[(0,i.jsxs)("div",{className:"upload-modal-header",children:[(0,i.jsxs)("h3",{children:["profilePhoto"===v&&"Cambiar foto de perfil","photos"===v&&"Subir fotos","documents"===v&&"Subir documentos"]}),(0,i.jsx)("button",{className:"close-button",onClick:()=>{g(!1)},children:"\xd7"})]}),(0,i.jsx)("div",{className:"upload-modal-body",children:(0,i.jsx)(c,{personId:e,type:v,onUploadComplete:e=>{e&&e.success&&(r(a=>"profilePhoto"===v?{...a,profilePhoto:e.data.fileUrl}:"photos"===v?{...a,photos:[...a.photos||[],...e.data.uploadedPhotos]}:"documents"===v?{...a,documents:[...a.documents||[],...e.data.uploadedDocuments]}:a),g(!1))}})})]})})]})}},4505:(e,a,t)=>{t.d(a,{A:()=>n});var s=t(6213),o=t(2014);const r=s.A.create({baseURL:"https://genea-api.onrender.com/api",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(async e=>{const{data:a}=await o.N.auth.getSession(),t=a.session;return t&&(e.headers.Authorization=`Bearer ${t.access_token}`),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(o.N.auth.signOut(),window.location.href="/login"),Promise.reject(e)));const n=r},6445:(e,a,t)=>{t.d(a,{A:()=>o});var s=t(4505);t(2014);const o={getAllPersons:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await s.A.get("/persons",{params:e})).data}catch(a){throw a}},getFamilyPersons:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return(await s.A.get("/persons",{params:{...a,familyId:e}})).data}catch(t){throw t}},getPersonById:async e=>{try{return(await s.A.get(`/persons/${e}`)).data}catch(a){throw a}},createPerson:async e=>{try{return(await s.A.post("/persons",e)).data}catch(a){throw a}},updatePerson:async(e,a)=>{try{return(await s.A.put(`/persons/${e}`,a)).data}catch(t){throw t}},deletePerson:async e=>{try{return(await s.A.delete(`/persons/${e}`)).data}catch(a){throw a}},addRelation:async e=>{try{return(await s.A.post("/persons/relation",e)).data}catch(a){throw a}},removeRelation:async e=>{try{return(await s.A.delete("/persons/relation",{data:e})).data}catch(a){throw a}},getPersonTree:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return(await s.A.get(`/persons/${e}/tree`,{params:a})).data}catch(t){throw t}},searchPersons:async(e,a)=>{try{return(await s.A.get("/persons",{params:{query:e,familyId:a}})).data}catch(t){throw t}},getPersonRelationships:async e=>{try{return(await s.A.get(`/persons/${e}/relationships`)).data}catch(a){throw a}}}}}]);
//# sourceMappingURL=975.dcd96b6f.chunk.js.map