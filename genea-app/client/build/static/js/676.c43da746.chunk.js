"use strict";(self.webpackChunkgenea_client=self.webpackChunkgenea_client||[]).push([[676],{4505:(e,a,t)=>{t.d(a,{A:()=>l});var s=t(6213),n=t(2014);const r=s.A.create({baseURL:"https://genea-api.onrender.com/api",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(async e=>{const{data:a}=await n.N.auth.getSession(),t=a.session;return t&&(e.headers.Authorization=`Bearer ${t.access_token}`),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(n.N.auth.signOut(),window.location.href="/login"),Promise.reject(e)));const l=r},6445:(e,a,t)=>{t.d(a,{A:()=>n});var s=t(4505);t(2014);const n={getAllPersons:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await s.A.get("/persons",{params:e})).data}catch(a){throw a}},getFamilyPersons:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return(await s.A.get("/persons",{params:{...a,familyId:e}})).data}catch(t){throw t}},getPersonById:async e=>{try{return(await s.A.get(`/persons/${e}`)).data}catch(a){throw a}},createPerson:async e=>{try{return(await s.A.post("/persons",e)).data}catch(a){throw a}},updatePerson:async(e,a)=>{try{return(await s.A.put(`/persons/${e}`,a)).data}catch(t){throw t}},deletePerson:async e=>{try{return(await s.A.delete(`/persons/${e}`)).data}catch(a){throw a}},addRelation:async e=>{try{return(await s.A.post("/persons/relation",e)).data}catch(a){throw a}},removeRelation:async e=>{try{return(await s.A.delete("/persons/relation",{data:e})).data}catch(a){throw a}},getPersonTree:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return(await s.A.get(`/persons/${e}/tree`,{params:a})).data}catch(t){throw t}},searchPersons:async(e,a)=>{try{return(await s.A.get("/persons",{params:{query:e,familyId:a}})).data}catch(t){throw t}},getPersonRelationships:async e=>{try{return(await s.A.get(`/persons/${e}/relationships`)).data}catch(a){throw a}}}},8676:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var s=t(5043),n=t(3216),r=t(8416),l=t(579);const i=e=>{let{data:a,onPersonClick:t,viewType:n="horizontal"}=e;const i=(0,s.useRef)(),[c,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!a)return;const e=r.Ltv(i.current);e.selectAll("*").remove();const s=1e3,l=40,d=120,h=40,u=120,p=r.Sk5(a);let m;m="vertical"===n?r.B22().size([s-u-d,600-l-h]):r.B22().size([600-l-h,s-d-u]),m(p);const x=e.append("g").attr("class","tree-container").attr("transform",`translate(${u},${l})`),v="vertical"===n?r.vu().x(e=>e.x).y(e=>e.y):r.pqs().x(e=>e.y).y(e=>e.x);x.selectAll(".link").data(p.links()).enter().append("path").attr("class","link").attr("d",v);const j=x.selectAll(".node").data(p.descendants()).enter().append("g").attr("class",e=>"node"+(e.children?" node--internal":" node--leaf")).attr("transform",e=>"vertical"===n?`translate(${e.x},${e.y})`:`translate(${e.y},${e.x})`).on("click",(e,a)=>{o(a),t&&t(a.data)});j.append("circle").attr("r",10).attr("class",e=>c&&e.data._id===c.data._id?"selected":""),j.append("text").attr("dy",".35em").attr("x",e=>"vertical"===n?0:e.children?-12:12).attr("y",e=>"vertical"===n?e.children?20:-20:0).style("text-anchor",e=>"vertical"===n?"middle":e.children?"end":"start").text(e=>e.data.fullName||e.data.name);const f=r.s_O().scaleExtent([.3,3]).on("zoom",e=>{x.attr("transform",e.transform)});e.call(f);const N=r.GSI.translate(500,300).scale(.8);e.call(f.transform,N),"ontouchstart"in window&&e.on("touchstart",function(e){e.preventDefault()})},[a,t,c,n]),(0,l.jsxs)("div",{className:"family-tree-container",children:[(0,l.jsxs)("div",{className:"tree-controls",children:[(0,l.jsx)("button",{className:"tree-control-btn",title:"Acercar",children:(0,l.jsx)("span",{children:"+"})}),(0,l.jsx)("button",{className:"tree-control-btn",title:"Alejar",children:(0,l.jsx)("span",{children:"-"})}),(0,l.jsx)("button",{className:"tree-control-btn",title:"Centrar",children:(0,l.jsx)("span",{children:"\u2302"})})]}),(0,l.jsx)("svg",{ref:i,width:"100%",height:"600"})]})},c=e=>{let{person:a,onClose:t}=e;return a?(0,l.jsxs)("div",{className:"person-detail",children:[(0,l.jsxs)("div",{className:"person-detail-header",children:[(0,l.jsx)("h2",{children:a.fullName}),(0,l.jsx)("button",{className:"close-button",onClick:t,children:"\xd7"})]}),(0,l.jsxs)("div",{className:"person-detail-content",children:[a.profilePhoto&&(0,l.jsx)("div",{className:"person-photo",children:(0,l.jsx)("img",{src:a.profilePhoto,alt:a.fullName})}),(0,l.jsxs)("div",{className:"person-info",children:[(0,l.jsxs)("div",{className:"info-row",children:[(0,l.jsx)("span",{className:"info-label",children:"Fecha de nacimiento:"}),(0,l.jsx)("span",{className:"info-value",children:a.birthDate?new Date(a.birthDate).toLocaleDateString():"Desconocida"})]}),a.birthPlace&&(0,l.jsxs)("div",{className:"info-row",children:[(0,l.jsx)("span",{className:"info-label",children:"Lugar de nacimiento:"}),(0,l.jsx)("span",{className:"info-value",children:a.birthPlace})]}),!a.isAlive&&a.deathDate&&(0,l.jsxs)("div",{className:"info-row",children:[(0,l.jsx)("span",{className:"info-label",children:"Fecha de fallecimiento:"}),(0,l.jsx)("span",{className:"info-value",children:new Date(a.deathDate).toLocaleDateString()})]}),!a.isAlive&&a.deathPlace&&(0,l.jsxs)("div",{className:"info-row",children:[(0,l.jsx)("span",{className:"info-label",children:"Lugar de fallecimiento:"}),(0,l.jsx)("span",{className:"info-value",children:a.deathPlace})]}),a.occupation&&(0,l.jsxs)("div",{className:"info-row",children:[(0,l.jsx)("span",{className:"info-label",children:"Ocupaci\xf3n:"}),(0,l.jsx)("span",{className:"info-value",children:a.occupation})]})]})]}),a.bio&&(0,l.jsxs)("div",{className:"person-bio",children:[(0,l.jsx)("h3",{children:"Biograf\xeda"}),(0,l.jsx)("p",{children:a.bio})]}),(0,l.jsxs)("div",{className:"person-actions",children:[(0,l.jsx)("button",{className:"action-button edit",children:"Editar"}),(0,l.jsx)("button",{className:"action-button photos",children:"Ver fotos"}),(0,l.jsx)("button",{className:"action-button documents",children:"Ver documentos"})]})]}):null};var o=t(6445);const d=()=>{const{familyId:e}=(0,n.g)(),[a,t]=(0,s.useState)(null),[r,d]=(0,s.useState)(!0),[h,u]=(0,s.useState)(null),[p,m]=(0,s.useState)(null),[x,v]=(0,s.useState)("horizontal"),[j,f]=(0,s.useState)(3),[N,b]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{d(!0);try{const e="1",a=await o.A.getPersonTree(e,{generations:j,includeSpouses:N});if(a.success&&a.data)return t(a.data),void d(!1)}catch(e){console.warn("Error al cargar datos de la API, usando datos de ejemplo:",e)}setTimeout(()=>{t({_id:"1",name:"Juan P\xe9rez",fullName:"Juan P\xe9rez",birthDate:"1950-05-15",isAlive:!0,children:[{_id:"2",name:"Mar\xeda P\xe9rez",fullName:"Mar\xeda P\xe9rez",birthDate:"1975-08-20",isAlive:!0,children:[{_id:"4",name:"Carlos G\xf3mez",fullName:"Carlos G\xf3mez",birthDate:"2000-03-10",isAlive:!0},{_id:"5",name:"Laura G\xf3mez",fullName:"Laura G\xf3mez",birthDate:"2002-11-05",isAlive:!0}]},{_id:"3",name:"Pedro P\xe9rez",fullName:"Pedro P\xe9rez",birthDate:"1978-12-03",isAlive:!0,children:[{_id:"6",name:"Ana P\xe9rez",fullName:"Ana P\xe9rez",birthDate:"2005-07-22",isAlive:!0}]}]}),d(!1)},800)}catch(a){u("Error al cargar los datos del \xe1rbol geneal\xf3gico"),d(!1),console.error("Error fetching tree data:",a)}})()},[e,j,N]);const y=e=>{v(e)};return r?(0,l.jsx)("div",{className:"loading-container",children:"Cargando \xe1rbol geneal\xf3gico..."}):h?(0,l.jsx)("div",{className:"error-container",children:h}):(0,l.jsxs)("div",{className:"tree-view-container",children:[(0,l.jsxs)("div",{className:"tree-header",children:[(0,l.jsx)("h1",{children:"\xc1rbol Geneal\xf3gico"}),(0,l.jsxs)("div",{className:"tree-options",children:[(0,l.jsxs)("div",{className:"view-type-selector",children:[(0,l.jsx)("button",{className:"view-type-btn "+("horizontal"===x?"active":""),onClick:()=>y("horizontal"),title:"Vista horizontal",children:"\u2194\ufe0f"}),(0,l.jsx)("button",{className:"view-type-btn "+("vertical"===x?"active":""),onClick:()=>y("vertical"),title:"Vista vertical",children:"\u2195\ufe0f"})]}),(0,l.jsxs)("div",{className:"generations-selector",children:[(0,l.jsx)("label",{htmlFor:"generations",children:"Generaciones:"}),(0,l.jsxs)("select",{id:"generations",value:j,onChange:e=>{f(parseInt(e.target.value))},children:[(0,l.jsx)("option",{value:"1",children:"1"}),(0,l.jsx)("option",{value:"2",children:"2"}),(0,l.jsx)("option",{value:"3",children:"3"}),(0,l.jsx)("option",{value:"4",children:"4"}),(0,l.jsx)("option",{value:"5",children:"5"})]})]}),(0,l.jsxs)("div",{className:"spouses-selector",children:[(0,l.jsx)("input",{type:"checkbox",id:"includeSpouses",checked:N,onChange:()=>{b(!N)}}),(0,l.jsx)("label",{htmlFor:"includeSpouses",children:"Incluir c\xf3nyuges"})]})]}),(0,l.jsxs)("div",{className:"tree-actions",children:[(0,l.jsx)("button",{className:"btn btn-outline",onClick:()=>{alert("Funcionalidad de exportaci\xf3n en desarrollo")},children:"Exportar \xe1rbol"}),(0,l.jsx)("button",{className:"btn btn-primary",children:"A\xf1adir persona"})]})]}),(0,l.jsx)("div",{className:"tree-visualization",children:(0,l.jsx)(i,{data:a,onPersonClick:e=>{m(e)},viewType:x})}),p&&(0,l.jsx)("div",{className:"person-detail-overlay",children:(0,l.jsx)("div",{className:"person-detail-container",children:(0,l.jsx)(c,{person:p,onClose:()=>{m(null)}})})})]})}}}]);
//# sourceMappingURL=676.c43da746.chunk.js.map